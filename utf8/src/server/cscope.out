cscope 15 $HOME/develop/pap/utf8/src/server -q 0000000513 0000054649
	@../../include/common/base/type.h

11 #i‚de‡
PAP_COMMON_PTYPE_H_


12 
	#PAP_COMMON_PTYPE_H_


	)

14 #i‡
deföed
(
GAME_CLIENT
)

15 
	#__ENTER_FUNCTION


	)

16 
	#__LEAVE_FUNCTION


	)

19 #i‚de‡
FD_SETSIZE


20 
	#FD_SETSIZE
 4906

	)

23 
	~<°dio.h
>

24 
	~<°döt.h
>

25 
	~<time.h
>

26 
	~<m©h.h
>

27 
	~<°d¨g.h
>

28 
	~<°rög
>

29 
	~<io°ªam
>

30 
	~<f°ªam
>

31 
	~"∑s£π.h
"

32 #i‡
deföed
(
__WINDOWS__
)

33 #¥agm®
w¨nög
 (
dißbÀ
: 4786)

34 
	~<Wödows.h
>

35 
	~"¸tdbg.h
"

36 #ñi‡
deföed
(
__LINUX__
)

37 
	~<°dlib.h
>

38 
	~<°rög.h
>

39 
	~<sys/ty≥s.h
>

40 
	~<±hªad.h
>

41 
	~<cm©h
>

47 
	tubyã
;

48 
	tbyã
;

49 
	tush‹t
;

51 
	#IP_SIZE
 24

52 
	#INVALID_HANDLE
 -1

	)

53 
	#INVALID_ID
 -1

	)

54 
	#INVALID_TAB_PARAM_ID
 (-9999)

55 #i‚de‡
_MAX_PATH


56 
	#_MAX_PATH
 260

	)

59 #i‚de‡
UINT_MAX


60 
	#UINT_MIN
 (0)

	)

61 
	#UINT_MAX
 (0xFFFFFFFF)

	)

64 #i‚de‡
INT_MAX


65 
	#INT_MIN
 (-2147483648)

	)

66 
	#INT_MAX
 (2147483647)

	)

69 #i‚de‡
DWORD_MAX


70 
	#DWORD_MIN
 
UINT_MIN


	)

71 
	#DWORD_MAX
 
UINT_MAX


	)

74 #i‚de‡
USHORT_MAX


75 
	#USHORT_MIN
 (0)

	)

76 
	#USHORT_MAX
 (0xFFFF)

	)

79 #i‚de‡
SHORT_MAX


80 
	#SHORT_MIN
 (-32768)

	)

81 
	#SHORT_MAX
 (32767)

	)

84 #i‚de‡
WORD_MAX


85 
	#WORD_MIN
 
USHORT_MIN


	)

86 
	#WORD_MAX
 
USHORT_MAX


	)

89 #i‚de‡
UCHAR_MAX


90 
	#UCHAR_MIN
 (0)

	)

91 
	#UCHAR_MAX
 (0xFF)

	)

94 #i‚de‡
CHAR_MAX


95 
	#CHAR_MIN
 (-128)

	)

96 
	#CHAR_MAX
 (127)

	)

99 #i‚de‡
BYTE_MAX


100 
	#BYTE_MIN
 
UCHAR_MIN


	)

101 
	#BYTE_MAX
 
UCHAR_MAX


	)

105 #i‚de‡
SAFE_DELETE


106 #i‡
deföed
(
__WINDOWS__
)

107 
	#SAFE_DELETE
(
x
Ëif((x)!=
NULL
Ë{ 
	`As£π
(
	`_CπIsVÆidHópPoöãr
(x));
	`dñëe
 (x); (x)=NULL; }

	)

108 #ñi‡
deföed
(
__LINUX__
)

109 
	#SAFE_DELETE
(
x
Ëif((x)!=
NULL
Ë{ 
	`dñëe
 (x); (x)=NULL; }

	)

113 #i‚de‡
SAFE_DELETE_ARRAY


114 #i‡
deföed
(
__WINDOWS__
)

115 
	#SAFE_DELETE_ARRAY
(
x
Ëif((x)!=
NULL
Ë{ 
	`As£π
(
	`_CπIsVÆidHópPoöãr
(x));
dñëe
[] (x); (x)=NULL; }

	)

116 #ñi‡
deföed
(
__LINUX__
)

117 
	#SAFE_DELETE_ARRAY
(
x
Ëif((x)!=
NULL
Ë{ 
dñëe
[] (x); (x)=NULL; }

	)

122 #i‚de‡
DELETE_ARRAY


123 #i‡
deföed
(
__WINDOWS__
)

124 
	#DELETE_ARRAY
(
x
Ëif((x)!=
NULL
Ë{ 
dñëe
[] (x); (x)=NULL; }

	)

125 #ñi‡
deföed
(
__LINUX__
)

126 
	#DELETE_ARRAY
(
x
Ëif((x)!=
NULL
Ë{ 
dñëe
[] (x); (x)=NULL; }

	)

130 #i‚de‡
SAFE_FREE


131 
	#SAFE_FREE
(
x
Ëif((x)!=
NULL
Ë{ 
	`‰ì
(x); (x)=NULL; }

	)

134 #i‚de‡
SAFE_RELEASE


135 
	#SAFE_RELEASE
(
x
Ëif((x)!=
NULL
Ë{ (x)->
	`Rñó£
(); (x)=NULL; }

	)

138 #i‡
deföed
(
__WINDOWS__
)

139 #i‡
deföed
(
NDEBUG
)

140 
	#__ENTER_FUNCTION
 {
åy
{

	)

141 
	#__LEAVE_FUNCTION
 }
	`ˇtch
(...){
	`As£πS≥cül
(
FALSE
,
__FUNCTION__
);}}

	)

143 
	#__ENTER_FUNCTION
 {
åy
{

	)

144 
	#__LEAVE_FUNCTION
 }
	`ˇtch
(...){
	`As£πS≥cül
(
FALSE
,
__FUNCTION__
);}}

	)

147 
	#LERR
(...) {\

148 
buf„r
[2048]; 
	`•rötf
(buf„r, 
__VA_ARGS__
); \

149 
buf„r
[2047] = '\0'; \

150 c⁄° * 
°¨t
 = "[ERROR...]"; \

151 c⁄° * 
íd
 = "[...ERROR]\r\n"; \

152 
size_t
 
f‹m©_Àngth
 = (
°¨t
Ë+ (
buf„r
Ë+ (
íd
); \

153 * 
f‹m©_°r
 = 
√w
 
CHAR
[
f‹m©_Àngth
 + 1]; \

154 
	`°r˝y
(
f‹m©_°r
, 
°¨t
); 
	`°rˇt
(f‹m©_°r, 
buf„r
); såˇt(f‹m©_°r, 
íd
); \

155 
	`¥ötf
(
f‹m©_°r
); \

156 
dñëe
[] 
f‹m©_°r
; \

157 }

	)

159 
	#LF
 "\r\n"

	)

160 #ñi‡
deföed
 (
__LINUX__
)

161 
	#__ENTER_FUNCTION
 {
åy
{

	)

162 
	#__LEAVE_FUNCTION
 }
	`ˇtch
(...){
	`As£πS≥cül
(
FALSE
,
__PRETTY_FUNCTION__
);}}

	)

164 
	#LERR
(...) {\

165 
buf„r
[2048]; 
	`•rötf
(buf„r, 
__VA_ARGS__
); \

166 
buf„r
[2047] = '\0'; \

167 c⁄° * 
°¨t
 = "\e[0;31;1m"; \

168 c⁄° * 
íd
 = "\e[0m\n"; \

169 
size_t
 
f‹m©_Àngth
 = (
°¨t
Ë+ (
buf„r
Ë+ (
íd
); \

170 * 
f‹m©_°r
 = 
√w
 
CHAR
[
f‹m©_Àngth
 + 1]; \

171 
	`°r˝y
(
f‹m©_°r
, 
°¨t
); 
	`°rˇt
(f‹m©_°r, 
buf„r
); såˇt(f‹m©_°r, 
íd
); \

172 
	`¥ötf
(
f‹m©_°r
); \

173 
dñëe
[] 
f‹m©_°r
; \

174 }

	)

176 
	#LF
 "\n"

	)

	@../../include/common/base/util.h

11 
	~"comm⁄/ba£/ty≥.h
"

12 
	~"comm⁄/ba£/md5.h
"

13 #i‚de‡
PAP_COMMON_BASE_UTIL_H_


14 
	#PAP_COMMON_BASE_UTIL_H_


	)

16 
«me•a˚
 
	g∑p_comm⁄_ba£_utû
 {

18 
vÆue_to_ascii
(
ö
);

19 
ascii_to_vÆue
(
ö
);

20 
boﬁ
 
bö¨y_to_°rög
(c⁄° * 
ö
, 
uöt
 
ö_Àngth
, * 
out
);

21 
boﬁ
 
°rög_to_bö¨y
(c⁄° * 
ö
,

22 
uöt32_t
 
ö_Àngth
,

23 * 
out
,

24 
uöt32_t
 
out_limô
,

25 
uöt32_t
 &
out_Àngth
);

26 
¶ìp
(
uöt32_t
 
mûli⁄_£c⁄ds
);

27 
uöt32_t
 
°r_Àngth
(c⁄° * 
°r
);

28 
ch¨_sw≠
(* 
°r
, 
uöt
 
sour˚
, 
uöt32_t
 
de°ö©i⁄
);

29 
sim∂e_í¸y±_de¸y±
–* 
°r
, 
uöt32_t
 
°r_Àngth
, uöt32_à
key_begö
 = 0);

30 
ch¨£t_c⁄vît
(c⁄° * 
‰om
,

31 c⁄° * 
to
,

32 * 
ßve
,

33 
ßvñí
,

34 * 
§c
,

35 
§˛í
) ;

37 
∑ssw‹d_sw≠_ch¨s
(* 
°r
);

	@../../include/common/game/all_defind.h

1 
	~"pgame_deföe.h
"

	@../../include/common/game/define.h

1 #i‚de‡
PAP_COMMON_PGAME_DEFINE_H_


2 
	#PAP_COMMON_PGAME_DEFINE_H_


	)

4 
	#INVALID_COUNTRY
 -1

	)

5 
	#INVALID_JOB
 -1

	)

6 
	#INVALID_SEX
 -1

	)

7 
	#INVALID_GUILD_ID
 -1

	)

8 
	#INVALID_RESOURCE
 -1

	)

9 
	#INVALID_RULERID
 -1

	)

10 
	#INVALID_PRICE
 0

	)

11 
	#INVALID_ITEM_ID
 0

	)

12 
	#INVALID_ITEM_POS
 -1

	)

13 
	#INVALID_TIME
 0xFFFFFFFF

	)

14 
	#INVALID_PAI_TYPE
 0

	)

15 
	#INVALID_SOUL_TYPE
 0

	)

16 
	#BASE_BAG_POS
 185

	)

19 
	#DB_CONNECTION_NAME_LENGTH
 128

	)

21 
	#DB_USER_NAME_LENGTH
 32

	)

23 
	#DB_PASSWORD_LENGTH
 32

	)

25 
	#DB_OPERATION_TIME
 500

	)

27 
	#DB_CHAR_NUMBER
 5

	)

29 
	#DB_2_SM_TIME
 60000

31 
	#DB_CONNECTION_COUNT
 40

	)

	@../../include/common/game/structs.h

1 #i‚de‡
PAP_COMMON_PGAME_STRUCT_H_


2 
	#PAP_COMMON_PGAME_STRUCT_H_


	)

	@../../include/common/md5.h

33 #i‚de‡
BZF_MD5_H


34 
	#BZF_MD5_H


	)

36 
	~<°rög
>

37 
	~<io°ªam
>

50 ˛as†
	cMD5


52 
	mpublic
:

53 
	tsize_ty≥
;

55 
MD5
();

56 
MD5
(c⁄° 
°d
::
°rög
& 
ãxt
);

57 
upd©e
(c⁄° *
buf
, 
size_ty≥
 
Àngth
);

58 
upd©e
(c⁄° *
buf
, 
size_ty≥
 
Àngth
);

59 
	mMD5
& 
föÆize
();

60 
	m°d
::
°rög
 
	$hexdige°
() const;

61 
°d
::
°rög
 
	$md5
() const;

62 
‰õnd
 
°d
::
o°ªam
& 
›î©‹
<<(°d::o°ªam&, 
MD5
 
md5
);

64 
¥iv©e
:

65 
	`öô
();

66 
	tuöt1
;

67 
	tuöt4
;

68 íum {
blocksize
 = 64};

70 
	`å™sf‹m
(c⁄° 
uöt1
 
block
[
blocksize
]);

71 
	`decode
(
uöt4
 
ouçut
[], c⁄° 
uöt1
 
öput
[], 
size_ty≥
 
Àn
);

72 
	`ícode
(
uöt1
 
ouçut
[], c⁄° 
uöt4
 
öput
[], 
size_ty≥
 
Àn
);

74 
boﬁ
 
föÆized
;

75 
uöt1
 
buf„r
[
blocksize
];

76 
uöt4
 
cou¡
[2];

77 
uöt4
 
°©e
[4];

78 
uöt1
 
dige°
[16];

81 
ölöe
 
uöt4
 
	`F
(uöt4 
x
, uöt4 
y
, uöt4 
z
);

82 
ölöe
 
uöt4
 
	`G
(uöt4 
x
, uöt4 
y
, uöt4 
z
);

83 
ölöe
 
uöt4
 
	`H
(uöt4 
x
, uöt4 
y
, uöt4 
z
);

84 
ölöe
 
uöt4
 
	`I
(uöt4 
x
, uöt4 
y
, uöt4 
z
);

85 
ölöe
 
uöt4
 
	`rŸ©e_À·
(uöt4 
x
, 
n
);

86 
ölöe
 
	`FF
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
);

87 
ölöe
 
	`GG
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
);

88 
ölöe
 
	`HH
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
);

89 
ölöe
 
	`II
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
);

90 
	}
};

	@../../include/common/sys/assert.h

11 #i‚de‡
PAP_COMMON_SYS_ASSERT_H_


12 
	#PAP_COMMON_SYS_ASSERT_H_


	)

14 
«me•a˚
 
	g∑p_comm⁄_sys_as£π
 {

16 
g_comm™d_as£π
;

17 
boﬁ
 
g_comm™d_ign‹e_mesßge_box
;

18 
g_fûe_«me_fix
;

19 
g_√ed_m™agî_do_pos_öô
;

21 
__as£π__
(c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
);

22 
__as£πex__
(c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
, c⁄° * 
msg
);

23 
__as£π•ecül__
(c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
, c⁄° * 
msg
);

24 
__mesßgebox__
(c⁄° * 
msg
);

25 
__¥Ÿocﬁ_as£π__
(c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
);

27 #i‡
deföed
(
NDEBUG
)

28 
	#As£π
(
ex¥
Ë(()0)

	)

29 
	#As£πEx
(
ex¥
,
msg
Ë(()0)

	)

30 
	#As£πS≥cül
(
ex¥
,
msg
Ë(()0)

	)

31 
	#MyMesßgeBox
(
msg
Ë(()0)

	)

32 #ñi‡
deföed
(
__LINUX__
)

33 
	#As£π
(
ex¥
Ë{if(!”x¥)){
	`__as£π__
(
__FILE__
,
__LINE__
,
__PRETTY_FUNCTION__
,#ex¥);}}

	)

34 
	#PrŸocﬁAs£π
(
ex¥
Ë(()(”x¥)?0:(
	`__¥Ÿocﬁ_as£π__
(
__FILE__
,
__LINE__
,
__PRETTY_FUNCTION__
,#ex¥),0)))

	)

35 
	#As£πEx
(
ex¥
,
msg
Ë{if(!”x¥)){
	`__as£πex__
(
__FILE__
,
__LINE__
,
__PRETTY_FUNCTION__
,#ex¥,msg);}}

	)

36 
	#As£πS≥cül
(
ex¥
,
msg
Ë{if(!”x¥)){
	`__as£π•ecül__
(
__FILE__
,
__LINE__
,
__PRETTY_FUNCTION__
,#ex¥,msg);}}

	)

37 
	#As£πExPass
(
ex¥
,
msg
Ë{if(!”x¥)){
	`__as£πex__
(
__FILE__
,
__LINE__
,
__PRETTY_FUNCTION__
,#ex¥,msg);}}

	)

38 
	#MyMesßgeBox
(
msg
Ë(()0)

	)

39 #ñi‡
deföed
(
__WIN_CONSOLE__
Ë|| deföed(
__WIN32__
Ë|| deföed(
__WINDOWS__
)

40 
	#As£π
(
ex¥
Ë(()(”x¥)?0:(
	`__as£π__
(
__FILE__
,
__LINE__
,
__FUNCTION__
,#ex¥),0)))

	)

41 
	#As£πEx
(
ex¥
,
msg
Ë(()(”x¥)?0:(
	`__as£πex__
(
__FILE__
,
__LINE__
,
__FUNCTION__
,#ex¥,msg),0)))

	)

42 
	#As£πS≥cül
(
ex¥
,
msg
Ë(()(”x¥)?0:(
	`__as£π•ecül__
(
__FILE__
,
__LINE__
,
__FUNCTION__
,#ex¥,msg),0)))

	)

43 
	#MyMesßgeBox
(
msg
Ë
	`__mesßgebox__
(msg)

	)

44 #ñi‡
deföed
(
__MFC__
)

45 
	#As£π
(
ex¥
Ë
	`ASSERT
”x¥)

	)

46 
	#As£πEx
(
ex¥
,
msg
Ë(()0)

	)

47 
	#As£πS≥cül
(
ex¥
,
msg
Ë(()0)

	)

48 
	#MyMesßgeBox
(
msg
Ë(()0)

	)

59 
boﬁ
 
R™geCheckF‹Index_As£π
(
ödex
, 
‰om
, 
to
, c⁄°* 
code_loˇti⁄
);

	@../../include/common/sys/info.h

13 #i‚de‡
PAP_COMMON_PSYSTEMINFO_H_


14 
	#PAP_COMMON_PSYSTEMINFO_H_


	)

16 
	~<sys/c⁄fig.h
>

17 
	~<°döt.h
>

18 
	~<ve˘‹
>

19 
	~"±y≥.h
"

21 
«me•a˚
 
	gPSy°emInfo
 {

25 
öt64_t
 
	gu±ime_£c⁄d
;

26 
uöt64_t
 
	gavîage_lﬂd
[3];

27 
uöt64_t
 
	gøm_tŸÆ
;

28 
uöt64_t
 
	gøm_‰ì
;

29 
uöt64_t
 
	gøm_sh¨ed
;

30 
uöt64_t
 
	gøm_buf„r
;

31 
uöt64_t
 
	gsw≠_tŸÆ
;

32 
uöt64_t
 
	gsw≠_‰ì
;

33 
ush‹t
 
	g¥o˚ss_numbî
;

34 } 
	tsys_öfo_t
;

38 
öt64_t
 
	gu£r_time
;

39 
öt64_t
 
	gsy°em_time
;

40 
öt64_t
 
	gu£r_time_chûd
;

41 
öt64_t
 
	gsy°em_time_chûd
;

42 } 
	t¥o˚ss_öfo_t
;

47 
uöt64_t
 
	gtŸÆ
;

48 
uöt32_t
 
	gu£r
;

49 
uöt32_t
 
	gni˚
;

50 
uöt32_t
 
	gsy°em
;

51 
uöt32_t
 
	gidÀ
;

52 
uöt32_t
 
	giowaô
;

53 
uöt32_t
 
	gúq
;

54 
uöt32_t
 
	gso·úq
;

55 
	guöt
 ;

56 } 
	t˝u_öfo_t
;

58 
boﬁ
 
gë_sys_öfo
();

	@../common/base/md5.cc

34 
	~"comm⁄/md5.h
"

37 
	~<°dio.h
>

38 
	~<°rög.h
>

42 
	#S11
 7

	)

43 
	#S12
 12

	)

44 
	#S13
 17

	)

45 
	#S14
 22

	)

46 
	#S21
 5

	)

47 
	#S22
 9

	)

48 
	#S23
 14

	)

49 
	#S24
 20

	)

50 
	#S31
 4

	)

51 
	#S32
 11

	)

52 
	#S33
 16

	)

53 
	#S34
 23

	)

54 
	#S41
 6

	)

55 
	#S42
 10

	)

56 
	#S43
 15

	)

57 
	#S44
 21

	)

61 
ölöe
 
	gMD5
::
uöt4
 
MD5
::
	$F
(
uöt4
 
x
, uöt4 
y
, uöt4 
z
) {

62  (
x
 & 
y
Ë| ((~xË& 
z
);

63 
	}
}

65 
ölöe
 
	gMD5
::
uöt4
 
MD5
::
	$G
(
uöt4
 
x
, uöt4 
y
, uöt4 
z
) {

66  (
x
&
z
Ë| (
y
&~z);

67 
	}
}

69 
ölöe
 
	gMD5
::
uöt4
 
MD5
::
	$H
(
uöt4
 
x
, uöt4 
y
, uöt4 
z
) {

70  
x
^
y
^
z
;

71 
	}
}

73 
ölöe
 
	gMD5
::
uöt4
 
MD5
::
	$I
(
uöt4
 
x
, uöt4 
y
, uöt4 
z
) {

74  
y
 ^ (
x
 | ~
z
);

75 
	}
}

78 
ölöe
 
	gMD5
::
uöt4
 
MD5
::
	$rŸ©e_À·
(
uöt4
 
x
, 
n
) {

79  (
x
 << 
n
) | (x >> (32-n));

80 
	}
}

84 
ölöe
 
	gMD5
::
	$FF
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
) {

85 
a
 = 
	`rŸ©e_À·
◊+ 
	`F
(
b
,
c
,
d
Ë+ 
x
 + 
ac
, 
s
) + b;

86 
	}
}

88 
ölöe
 
	gMD5
::
	$GG
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
) {

89 
a
 = 
	`rŸ©e_À·
◊ + 
	`G
(
b
,
c
,
d
Ë+ 
x
 + 
ac
, 
s
) + b;

90 
	}
}

92 
ölöe
 
	gMD5
::
	$HH
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
) {

93 
a
 = 
	`rŸ©e_À·
◊ + 
	`H
(
b
,
c
,
d
Ë+ 
x
 + 
ac
, 
s
) + b;

94 
	}
}

96 
ölöe
 
	gMD5
::
	$II
(
uöt4
 &
a
, uöt4 
b
, uöt4 
c
, uöt4 
d
, uöt4 
x
, uöt4 
s
, uöt4 
ac
) {

97 
a
 = 
	`rŸ©e_À·
◊ + 
	`I
(
b
,
c
,
d
Ë+ 
x
 + 
ac
, 
s
) + b;

98 
	}
}

103 
	gMD5
::
	$MD5
()

105 
	`öô
();

106 
	}
}

111 
	gMD5
::
MD5
(c⁄° 
°d
::
°rög
 &
ãxt
)

113 
öô
();

114 
upd©e
(
ãxt
.
c_°r
(),Åext.
Àngth
());

115 
föÆize
();

120 
	gMD5
::
	$öô
()

122 
föÆized
=
Ál£
;

124 
cou¡
[0] = 0;

125 
cou¡
[1] = 0;

128 
°©e
[0] = 0x67452301;

129 
°©e
[1] = 0xefcdab89;

130 
°©e
[2] = 0x98badcfe;

131 
°©e
[3] = 0x10325476;

132 
	}
}

137 
	gMD5
::
	$decode
(
uöt4
 
ouçut
[], c⁄° 
uöt1
 
öput
[], 
size_ty≥
 
Àn
)

139 
i
 = 0, 
j
 = 0; j < 
Àn
; i++, j += 4)

140 
ouçut
[
i
] = ((
uöt4
)
öput
[
j
]) | (((uint4)input[j+1]) << 8) |

141 (((
uöt4
)
öput
[
j
+2]) << 16) | (((uint4)input[j+3]) << 24);

142 
	}
}

148 
	gMD5
::
	$ícode
(
uöt1
 
ouçut
[], c⁄° 
uöt4
 
öput
[], 
size_ty≥
 
Àn
)

150 
size_ty≥
 
i
 = 0, 
j
 = 0; j < 
Àn
; i++, j += 4) {

151 
ouçut
[
j
] = 
öput
[
i
] & 0xff;

152 
ouçut
[
j
+1] = (
öput
[
i
] >> 8) & 0xff;

153 
ouçut
[
j
+2] = (
öput
[
i
] >> 16) & 0xff;

154 
ouçut
[
j
+3] = (
öput
[
i
] >> 24) & 0xff;

156 
	}
}

161 
	gMD5
::
	$å™sf‹m
(c⁄° 
uöt1
 
block
[
blocksize
])

163 
uöt4
 
a
 = 
°©e
[0], 
b
 = sèã[1], 
c
 = sèã[2], 
d
 = sèã[3], 
x
[16];

164 
	`decode
 (
x
, 
block
, 
blocksize
);

167 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S11
, 0xd76aa478);

168 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 1], 
S12
, 0xe8c7b756);

169 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S13
, 0x242070db);

170 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 3], 
S14
, 0xc1bdceee);

171 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S11
, 0xf57c0faf);

172 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 5], 
S12
, 0x4787c62a);

173 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S13
, 0xa8304613);

174 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 7], 
S14
, 0xfd469501);

175 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S11
, 0x698098d8);

176 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 9], 
S12
, 0x8b44f7af);

177 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S13
, 0xffff5bb1);

178 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[11], 
S14
, 0x895cd7be);

179 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S11
, 0x6b901122);

180 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[13], 
S12
, 0xfd987193);

181 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S13
, 0xa679438e);

182 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[15], 
S14
, 0x49b40821);

185 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S21
, 0xf61e2562);

186 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 6], 
S22
, 0xc040b340);

187 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S23
, 0x265e5a51);

188 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 0], 
S24
, 0xe9b6c7aa);

189 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 5], 
S21
, 0xd62f105d);

190 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[10], 
S22
, 0x2441453);

191 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[15], 
S23
, 0xd8a1e681);

192 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 4], 
S24
, 0xe7d3fbc8);

193 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 9], 
S21
, 0x21e1cde6);

194 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[14], 
S22
, 0xc33707d6);

195 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 3], 
S23
, 0xf4d50d87);

196 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 8], 
S24
, 0x455a14ed);

197 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[13], 
S21
, 0xa9e3e905);

198 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 2], 
S22
, 0xfcefa3f8);

199 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S23
, 0x676f02d9);

200 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[12], 
S24
, 0x8d2a4c8a);

203 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 5], 
S31
, 0xfffa3942);

204 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 8], 
S32
, 0x8771f681);

205 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S33
, 0x6d9d6122);

206 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[14], 
S34
, 0xfde5380c);

207 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S31
, 0xa4beea44);

208 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 4], 
S32
, 0x4bdecfa9);

209 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S33
, 0xf6bb4b60);

210 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[10], 
S34
, 0xbebfbc70);

211 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[13], 
S31
, 0x289b7ec6);

212 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 0], 
S32
, 0xeaa127fa);

213 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 3], 
S33
, 0xd4ef3085);

214 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[ 6], 
S34
, 0x4881d05);

215 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 9], 
S31
, 0xd9d4d039);

216 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[12], 
S32
, 0xe6db99e5);

217 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[15], 
S33
, 0x1fa27cf8);

218 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[ 2], 
S34
, 0xc4ac5665);

221 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S41
, 0xf4292244);

222 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[ 7], 
S42
, 0x432aff97);

223 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S43
, 0xab9423a7);

224 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 5], 
S44
, 0xfc93a039);

225 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S41
, 0x655b59c3);

226 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[ 3], 
S42
, 0x8f0ccc92);

227 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S43
, 0xffeff47d);

228 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 1], 
S44
, 0x85845dd1);

229 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S41
, 0x6fa87e4f);

230 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[15], 
S42
, 0xfe2ce6e0);

231 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S43
, 0xa3014314);

232 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[13], 
S44
, 0x4e0811a1);

233 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S41
, 0xf7537e82);

234 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[11], 
S42
, 0xbd3af235);

235 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S43
, 0x2ad7d2bb);

236 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 9], 
S44
, 0xeb86d391);

238 
°©e
[0] +
a
;

239 
°©e
[1] +
b
;

240 
°©e
[2] +
c
;

241 
°©e
[3] +
d
;

244 
	`mem£t
(
x
, 0,  x);

245 
	}
}

251 
	gMD5
::
	$upd©e
(c⁄° 
öput
[], 
size_ty≥
 
Àngth
)

254 
size_ty≥
 
ödex
 = 
cou¡
[0] / 8 % 
blocksize
;

257 i‡((
cou¡
[0] +(
Àngth
 << 3)) < (length << 3))

258 
cou¡
[1]++;

259 
cou¡
[1] +(
Àngth
 >> 29);

262 
size_ty≥
 
fú°∑π
 = 64 - 
ödex
;

264 
size_ty≥
 
i
;

267 i‡(
Àngth
 >
fú°∑π
)

270 
	`mem˝y
(&
buf„r
[
ödex
], 
öput
, 
fú°∑π
);

271 
	`å™sf‹m
(
buf„r
);

274 
i
 = 
fú°∑π
; i + 
blocksize
 <
Àngth
; i += blocksize)

275 
	`å™sf‹m
(&
öput
[
i
]);

277 
ödex
 = 0;

280 
i
 = 0;

283 
	`mem˝y
(&
buf„r
[
ödex
], &
öput
[
i
], 
Àngth
-i);

284 
	}
}

289 
	gMD5
::
	$upd©e
(c⁄° 
öput
[], 
size_ty≥
 
Àngth
)

291 
	`upd©e
((c⁄° *)
öput
, 
Àngth
);

292 
	}
}

298 
	gMD5
& MD5::
	$föÆize
()

300 
∑ddög
[64] = {

306 i‡(!
föÆized
) {

308 
bôs
[8];

309 
	`ícode
(
bôs
, 
cou¡
, 8);

312 
size_ty≥
 
ödex
 = 
cou¡
[0] / 8 % 64;

313 
size_ty≥
 
∑dLí
 = (
ödex
 < 56) ? (56 - index) : (120 - index);

314 
	`upd©e
(
∑ddög
, 
∑dLí
);

317 
	`upd©e
(
bôs
, 8);

320 
	`ícode
(
dige°
, 
°©e
, 16);

323 
	`mem£t
(
buf„r
, 0,  buffer);

324 
	`mem£t
(
cou¡
, 0,  count);

326 
föÆized
=
åue
;

329  *
this
;

330 
	}
}

335 
	g°d
::
°rög
 
MD5
::
	$hexdige°
() const

337 i‡(!
föÆized
)

340 
buf
[33];

341 
i
=0; i<16; i++)

342 
	`•rötf
(
buf
+
i
*2, "%02x", 
dige°
[i]);

343 
buf
[32]=0;

345  
°d
::
	`°rög
(
buf
);

346 
	}
}

347 
	g°d
::
°rög
 
MD5
::
	$md5
() const

349  
	`hexdige°
();

350 
	}
}

355 
	g°d
::
o°ªam
& 
›î©‹
<<(
°d
::o°ªam& 
out
, 
MD5
 
	gmd5
)

357  
	gout
 << 
	gmd5
.
hexdige°
();

	@../common/base/util.cc

1 
	~"comm⁄/ba£/as£π.h
"

3 
«me•a˚
 
	g∑p_comm⁄_ba£_utû
 {

5 
vÆue_to_ascii
(
ö
) {

6 
__ENTER_FUNCTION


7 
	gout
;

8 
	gö
) {

10 
out
 = '0';

14 
out
 = '1';

18 
out
 = '2';

22 
out
 = '3';

26 
out
 = '4';

30 
out
 = '5';

34 
out
 = '6';

38 
out
 = '7';

42 
out
 = '8';

46 
out
 = '9';

50 
out
 = 'A';

54 
out
 = 'B';

58 
out
 = 'C';

62 
out
 = 'D';

66 
out
 = 'E';

70 
out
 = 'F';

74 
out
 = '?';

75 
As£π
(
Ál£
);

78  
	gout
;

79 
__LEAVE_FUNCTION


83 
ascii_to_vÆue
(
ö
) {

84 
__ENTER_FUNCTION


85 
	gout
;

86 
	gö
) {

88 
out
 = 0;

92 
out
 = 1;

96 
out
 = 2;

100 
out
 = 3;

104 
out
 = 4;

108 
out
 = 5;

112 
out
 = 6;

116 
out
 = 7;

120 
out
 = 8;

124 
out
 = 9;

128 
out
 = 10;

132 
out
 = 11;

136 
out
 = 12;

140 
out
 = 13;

144 
out
 = 14;

148 
out
 = 15;

152 
out
 = '?';

153 
As£π
(
Ál£
);

156  
	gout
;

157 
__LEAVE_FUNCTION


161 
boﬁ
 
bö¨y_to_°rög
(c⁄° * 
ö
, 
uöt32_t
 
ö_Àngth
, * 
out
) {

162 
__ENTER_FUNCTION


163 i‡(0 =
ö_Àngth
Ë 
Ál£
;

164 
uöt32_t
 
	gout_ödex
 = 0;

165 
uöt32_t
 
	gi
;

166 
	gi
 = 0; i < 
	gö_Àngth
; ++i) {

167 
	gout
[
out_ödex
] = 
vÆue_to_ascii
((
°©ic_ˇ°
<
ubyã
>(
ö
[
i
] & 0xF0)) >> 4);

168 ++
	gout_ödex
;

169 
	gout
[
out_ödex
] = 
vÆue_to_ascii
(
ö
[
i
] & 0xF0);

170 ++
	gout_ödex
;

172  
	gåue
;

173 
__LEAVE_FUNCTION


174  
	gÁl£
;

177 
boﬁ
 
°rög_to_bö¨y
(c⁄° * 
ö
,

178 
uöt32_t
 
ö_Àngth
,

179 * 
out
,

180 
uöt32_t
 
out_limô
,

181 
uöt32_t
 &
out_Àngth
) {

182 
__ENTER_FUNCTION


183 i‡(0 =
ö_Àngth
Ë 
Ál£
;

184 
uöt32_t
 
	gout_ödex
 = 0;

185 
uöt32_t
 
	gi
;

186 
	gi
 = 0; i < 
	gö_Àngth
; ++i) {

187 i‡('\0' =
ö
[
i
] || '\0' == in[i]) ;

188 
	gout
[
out_ödex
] = (
ascii_to_vÆue
(
ö
[
i
]) << 4) +áscii_to_value(in[i + 1]);

189 ++
	gout_ödex
;

190 
	gi
 += 2;

191 i‡(
	gout_ödex
 > 
	gout_limô
) ;

193 
	gout_Àngth
 = 
out_ödex
;

194  
	gåue
;

195 
__LEAVE_FUNCTION


196  
	gÁl£
;

199 
¶ìp
(
uöt32_t
 
mûli⁄_£c⁄ds
) {

200 
	g__ENTER_FUNCTION


201 #i‡
deföed
(
__WINDOWS__
)

202 
SÀï
(
mûli⁄_£c⁄ds
);

203 #ñi‡
deföed
(
__LINUX__
)

204 
u¶ìp
(
mûli⁄_£c⁄ds
 * 1000);

206 
	g__LEAVE_FUNCTION


209 
uöt32_t
 
°r_Àngth
(c⁄° * 
°r
) {

210 
__ENTER_FUNCTION


211 
uöt32_t
 
	gi
 = 0;

212 
	g°r
[
i
]Ë++
	gi
;

213  
	gi
;

214 
	g__LEAVE_FUNCTION


217 
ch¨_sw≠
(* 
°r
, 
uöt32_t
 
sour˚
, uöt32_à
de°ö©i⁄
) {

218 
__ENTER_FUNCTION


219 
uöt32_t
 
	g°r_Àngth
 = 
°r_Àngth
(
°r
);

220 i‡((0 > 
	gsour˚
 || 
	g°r_Àngth
 < source) ||

221 (0 > 
	gde°ö©i⁄
 || 
	g°r_Àngth
 < destination)) {

224 
	gãmp
 = 
°r
[
sour˚
];

225 
	g°r
[
sour˚
] = 
°r
[
de°ö©i⁄
];

226 
	g°r
[
de°ö©i⁄
] = 
ãmp
;

227 
	g__LEAVE_FUNCTION


230 
∑ssw‹d_sw≠_ch¨s
(* 
°r
) {

231 
__ENTER_FUNCTION


232 
ch¨_sw≠
(
°r
, 0, 13);

233 
ch¨_sw≠
(
°r
, 31, 25);

234 
ch¨_sw≠
(
°r
, 12, 30);

235 
ch¨_sw≠
(
°r
, 7, 19);

236 
ch¨_sw≠
(
°r
, 3, 21);

237 
ch¨_sw≠
(
°r
, 9, 20);

238 
ch¨_sw≠
(
°r
, 15, 18);

239 
	g__LEAVE_FUNCTION


242 
sim∂e_í¸y±_de¸y±
(* 
°r
, 
uöt32_t
 
°r_Àngth
, uöt32_à
key_begö
) {

243 
__ENTER_FUNCTION


244 
uöt32_t
 
	g°r_Àngth
 = 
°r_Àngth
(
°r
);

245 i‡(0 <
°r_Àngth
) ;

246 
MD5
 
°r_md5
(
°r
);

247 * 
	gkey
 = 
°r_md5
.
md5
();

249 
∑ssw‹d_sw≠_ch¨s
(
key
);

250 
uöt32_t
 
	gkey_Àngth
 = 
°r_Àngth
(
key
);

251 
uöt32_t
 
	gi
;

252 
	gi
 = 0; i < 
	g°r_Àngth
; ++i) {

253 *
	g°r
 ^
key
[(
i
 + 
key_begö
Ë% 
key_Àngth
];

254 
	g°r
++;

256 
	g__LEAVE_FUNCTION


268 
ch¨£t_c⁄vît
(c⁄° * 
‰om
,

269 c⁄° * 
to
,

270 * 
ßve
,

271 
ßvñí
,

272 * 
§c
,

273 
§˛í
) {

274 
__ENTER_FUNCTION


275 
ic⁄v_t
 
	gcd
;

276 *
	göbuf
 = 
§c
;

277 *
	goutbuf
 = 
ßve
;

278 
size_t
 
	goutbufsize
 = 
ßvñí
;

279 
	g°©us
 = 0;

280 
size_t
 
	gßvesize
 = 0;

281 
size_t
 
	göbufsize
 = 
§˛í
;

282 c⁄° * 
	gö±r
 = 
öbuf
;

283 
size_t
 
	gösize
 = 
öbufsize
;

284 * 
	gouçå
 = 
outbuf
;

285 
size_t
 
	goutsize
 = 
outbufsize
;

287 
	gcd
 = 
ic⁄v_›í
(
to
, 
‰om
);

288 
ic⁄v
(
cd
, 
NULL
, NULL, NULL, NULL);

289 i‡(0 =
öbufsize
) {

290 
°©us
 = -1;

291 
	gd⁄e
;

293 0 < 
	gösize
) {

294 
size_t
 
	gªs
 = 
ic⁄v
(
cd
, (**)&
ö±r
, &
ösize
, &
ouçå
, &
outsize
);

295 i‡(
	gouçå
 !
outbuf
) {

296 
ßved_î∫o
 = 
î∫o
;

297 
	goutsize
 = 
ouçå
 - 
outbuf
;

298 
°∫˝y
(
ßve
 + 
ßvesize
, 
outbuf
, 
outsize
);

299 
	gî∫o
 = 
ßved_î∫o
;

301 i‡((
	gsize_t
)(-1Ë=
ªs
) {

302 i‡(
EILSEQ
 =
î∫o
) {

303 
⁄e
 = 1 ;

304 
ic⁄v˘l
(
cd
, 
ICONV_SET_DISCARD_ILSEQ
, &
⁄e
);

305 
	g°©us
 = -3;

307 i‡(
	gEINVAL
 =
î∫o
) {

308 i‡(0 =
öbufsize
) {

309 
°©us
 = -4;

310 
	gd⁄e
;

316 i‡(
	gE2BIG
 =
î∫o
) {

317 
°©us
 = -5;

318 
	gd⁄e
;

321 
	g°©us
 = -6;

322 
	gd⁄e
;

326 
	g°©us
 = 
°æí
(
ßve
);

327 
	gd⁄e
:

328 
ic⁄v_˛o£
(
cd
);

329  
	g°©us
;

330 
	g__LEAVE_FUNCTION


	@../common/sys/assert.cc

1 
	~"comm⁄/∑s£π.h
"

2 #ifde‡
__LINUX__


3 
	~<execöfo.h
>

5 
	~"time.h
"

6 
	~"comm⁄/±y≥.h
"

14 
	gg_Comm™d_As£π
 = 0;

15 
boﬁ
 
	gg_Comm™d_Ign‹eMesßgeBox
 = 
Ál£
;

16 
	gg_NìdM™agîDoPosInô
 = 1;

18 
	$__show__
(c⁄° * 
ãmp
) {

19 #ifde‡
__LINUX__


20 
	`¥ötf
("As£π:%s",
ãmp
);

23 #i‚de‡
GAME_CLIENT


24 
FILE
* 
f
 = 
	`f›í
( "./Log/assert.log", "a" ) ;

25 
	`fwrôe
–
ãmp
, 1, 
	`°æí
—emp), 
f
 ) ;

26 
	`fwrôe
–"\n", 1, 2, 
f
 ) ;

27 
	`f˛o£
(
f
) ;

30 #i‡
	`deföed
(
__WINDOWS__
)

31 
MyLock
 
lock
 ;

32 i‡(1 !
g_Comm™d_As£π
) {

33 
lock
.
	`Lock
() ;

34 
ªt
 = ::
	`MesßgeBoxA
–
NULL
, 
ãmp
, "ÂºÇÂ∏∏", 
MB_OK
 ) ;

35 
lock
.
	`U∆ock
() ;

37 #ñi‡
	`deföed
(
__LINUX__
)

40 #ifde‡
GAME_CLIENT


41 
	`throw
(
°d
::
	`°rög
(
ãmp
));

43 
	`throw
(1);

45 
	}
}

47 
	$__mesßgebox__
(c⁄° * 
msg
) {

48 i‡(
g_Comm™d_Ign‹eMesßgeBox
)

50 #i‡
	`deföed
(
__WINDOWS__
)

51 ::
	`MesßgeBoxA
(
NULL
, 
msg
, "‰ø°ÊÅØ", 
MB_OK
);

52 #ñi‡
	`deföed
(
__LINUX__
)

54 
	}
}

56 
	$__as£π__
 (c⁄° * 
fûe
, 
löe
, c⁄° * 
func
 , c⁄° * 
ex¥
) {

57 
ãmp
[1024] = {0};

59 #ifde‡
__LINUX__


60 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]\n", 
fûe
, 
löe
, 
func
, 
ex¥
);

62 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]", 
fûe
, 
löe
, 
func
, 
ex¥
);

64 
	`__show__
(
ãmp
);

65 
	}
}

67 
	$__as£πex__
 (c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
,c⁄° * 
msg
) {

68 
ãmp
[1024] = {0};

69 #ifde‡
__LINUX__


70 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]\n[%s]\n", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
);

72 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]\n[%s]", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
);

74 
	`__show__
(
ãmp
);

75 
	}
}

77 
	$__as£π•ecül__
 (c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
,c⁄° * 
msg
) {

78 
ãmp
[1024] = {0};

80 #ifde‡
__LINUX__


81 
	`•rötf
(
ãmp
, "S[%s][%d][%s][%s]\n[%s]\n", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
) ;

83 
	`•rötf
(
ãmp
, "S[%s][%d][%s][%s]\n[%s]", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
 ) ;

85 
	`__show__
(
ãmp
) ;

86 
	}
}

88 
	$__¥Ÿocﬁ_as£π__
 ( c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
) {

89 
	`¥ötf
("[%s][%d][%s][%s]", 
fûe
, 
löe
, 
func
, 
ex¥
);

90 
	}
}

92 
boﬁ
 
	$R™geCheckF‹Index_As£π
(
ödex
, 
‰om
, 
to
, c⁄°* 
code_loˇti⁄
) {

93 
up_b‹dî
 = 0;

94 
low_b‹dî
 = 0;

95 
buff
[1024];

96 i‡(
‰om
 > 
to
) {

97 
up_b‹dî
 = 
‰om
;

98 
low_b‹dî
 = 
to
;

101 
up_b‹dî
 = 
to
;

102 
low_b‹dî
 = 
‰om
;

104 
	`As£π
(0 <
up_b‹dî
);

105 
	`As£π
(0 <
low_b‹dî
);

106 
	`As£π
(0 <
ödex
);

107 i‡(
ödex
 >
low_b‹dî
 && index <
up_b‹dî
) {

108  
åue
;

110 
	`¢¥ötf
(
buff
,

111 (
buff
),

113 
code_loˇti⁄
,

114 
ödex
,

115 
low_b‹dî
,

116 
up_b‹dî
);

117 
buff
[(buff)-1] = '\0';

118 
	`As£πEx
(
Ál£
, 
buff
);

119  
Ál£
;

120 
	}
}

	@../common/sys/passert.cc

1 #ifde‡
__LINUX__


2 
	~<execöfo.h
>

4 
	~"time.h
"

5 
	~"comm⁄/sys/as£π.h
"

6 
	~"comm⁄/ba£/ty≥.h
"

14 
	gg_comm™d_as£π
 = 0;

15 
boﬁ
 
	gg_comm™d_ign‹e_mesßge_box
 = 
Ál£
;

16 
	gg_√ed_m™agî_do_pos_öô
 = 1;

18 
	$__show__
(c⁄° * 
ãmp
) {

19 #ifde‡
__LINUX__


20 
	`¥ötf
("As£π:%s",
ãmp
);

23 #i‚de‡
GAME_CLIENT


24 
FILE
* 
f
 = 
	`f›í
( "./Log/assert.log", "a" ) ;

25 
	`fwrôe
–
ãmp
, 1, 
	`°æí
—emp), 
f
 ) ;

26 
	`fwrôe
–"\n", 1, 2, 
f
 ) ;

27 
	`f˛o£
(
f
) ;

30 #i‡
	`deföed
(
__WINDOWS__
)

31 
MyLock
 
lock
 ;

32 i‡(1 !
g_Comm™d_As£π
) {

33 
lock
.
	`Lock
() ;

34 
ªt
 = ::
	`MesßgeBoxA
–
NULL
, 
ãmp
, "ÂºÇÂ∏∏", 
MB_OK
 ) ;

35 
lock
.
	`U∆ock
() ;

37 #ñi‡
	`deföed
(
__LINUX__
)

40 #ifde‡
GAME_CLIENT


41 
	`throw
(
°d
::
	`°rög
(
ãmp
));

43 
	`throw
(1);

45 
	}
}

47 
	$__mesßgebox__
(c⁄° * 
msg
) {

48 i‡(
g_Comm™d_Ign‹eMesßgeBox
)

50 #i‡
	`deföed
(
__WINDOWS__
)

51 ::
	`MesßgeBoxA
(
NULL
, 
msg
, "‰ø°ÊÅØ", 
MB_OK
);

52 #ñi‡
	`deföed
(
__LINUX__
)

54 
	}
}

56 
	$__as£π__
 (c⁄° * 
fûe
, 
löe
, c⁄° * 
func
 , c⁄° * 
ex¥
) {

57 
ãmp
[1024] = {0};

59 #ifde‡
__LINUX__


60 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]\n", 
fûe
, 
löe
, 
func
, 
ex¥
);

62 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]", 
fûe
, 
löe
, 
func
, 
ex¥
);

64 
	`__show__
(
ãmp
);

65 
	}
}

67 
	$__as£πex__
 (c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
,c⁄° * 
msg
) {

68 
ãmp
[1024] = {0};

69 #ifde‡
__LINUX__


70 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]\n[%s]\n", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
);

72 
	`•rötf
(
ãmp
, "[%s][%d][%s][%s]\n[%s]", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
);

74 
	`__show__
(
ãmp
);

75 
	}
}

77 
	$__as£π•ecül__
 (c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
,c⁄° * 
msg
) {

78 
ãmp
[1024] = {0};

80 #ifde‡
__LINUX__


81 
	`•rötf
(
ãmp
, "S[%s][%d][%s][%s]\n[%s]\n", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
) ;

83 
	`•rötf
(
ãmp
, "S[%s][%d][%s][%s]\n[%s]", 
fûe
, 
löe
, 
func
, 
ex¥
, 
msg
 ) ;

85 
	`__show__
(
ãmp
) ;

86 
	}
}

88 
	$__¥Ÿocﬁ_as£π__
 ( c⁄° * 
fûe
, 
löe
, c⁄° * 
func
, c⁄° * 
ex¥
) {

89 
	`¥ötf
("[%s][%d][%s][%s]", 
fûe
, 
löe
, 
func
, 
ex¥
);

90 
	}
}

92 
boﬁ
 
	$R™geCheckF‹Index_As£π
(
ödex
, 
‰om
, 
to
, c⁄°* 
code_loˇti⁄
) {

93 
up_b‹dî
 = 0;

94 
low_b‹dî
 = 0;

95 
buff
[1024];

96 i‡(
‰om
 > 
to
) {

97 
up_b‹dî
 = 
‰om
;

98 
low_b‹dî
 = 
to
;

101 
up_b‹dî
 = 
to
;

102 
low_b‹dî
 = 
‰om
;

104 
	`As£π
(0 <
up_b‹dî
);

105 
	`As£π
(0 <
low_b‹dî
);

106 
	`As£π
(0 <
ödex
);

107 i‡(
ödex
 >
low_b‹dî
 && index <
up_b‹dî
) {

108  
åue
;

110 
	`¢¥ötf
(
buff
,

111 (
buff
),

113 
code_loˇti⁄
,

114 
ödex
,

115 
low_b‹dî
,

116 
up_b‹dî
);

117 
buff
[(buff)-1] = '\0';

118 
	`As£πEx
(
Ál£
, 
buff
);

119  
Ál£
;

120 
	}
}

	@../common/sys/systeminfo.cc

	@common/db/db_manager.cc

1 
	~"db_m™agî.h
"

3 
	gDBM™agî
::
	$DBM™agî
() {

4 
__ENTER_FUNCTION


5 
db_ty≥_
 = 
ALL_DATABASE
;

6 
ch¨a˘î_öãrÁ˚_
 = 
NULL
;

7 
u£r_öãrÁ˚_
 = 
NULL
;

8 
__LEAVE_FUNCTION


9 
	}
}

11 
	gDBM™agî
::~
	$DBM™agî
() {

12 
__ENTER_FUNCTION


13 
	`SAFE_DELETE
(
u£r_öãrÁ˚_
);

14 
	`SAFE_DELETE
(
ch¨a˘î_öãrÁ˚_
);

15 
__LEAVE_FUNCTION


16 
	}
}

18 
boﬁ
 
	gDBM™agî
::
	$öô
(
DB_TYPES
 
db_ty≥
) {

19 
__ENTER_FUNCTION


20 
db_ty≥_
 = 
db_ty≥
;

21 
ho°
[
HOST_LENGTH
];

22 
uöt
 
p‹t
;

23 
c⁄√˘i⁄_«me
[
DB_CONNECTION_NAME_LENGTH
];

24 
u£r
[
DB_USER_NAME_LENGTH
];

25 
∑ssw‹d
[
DB_PASSWORD_LENGTH
];

26 i‡(
ALL_DATABASE
 =
db_ty≥
 || 
CHARACTER_DATABASE
 == db_type) {

28 
ch¨a˘î_öãrÁ˚_
 = 
√w
 
	`ODBCI¡îÁ˚
();

29 
	`mem£t
(
ho°
, 0, 
HOST_LENGTH
);

30 
p‹t
 = 3306;

31 
	`mem£t
(
c⁄√˘i⁄_«me
, 0, 
DB_CONNECTION_NAME_LENGTH
);

32 
	`mem£t
(
u£r
, 0, 
DB_USER_NAME_LENGTH
);

33 
	`mem£t
(
∑ssw‹d
, 0, 
DB_PASSWORD_LENGTH
);

34 #i‡
	`deföed
(
_PAP_LOGIN
)

35 
	`°∫˝y
(
ho°
, 
g_c⁄fig
.
logö_öfo_
.
db_ho°_
, 
HOST_LENGTH
);

36 
p‹t
 = 
g_c⁄fig
.
logö_öfo_
.
db_p‹t_
;

37 
	`°∫˝y
(
c⁄√˘i⁄_«me
, 
g_c⁄fig
.
logö_öfo_
.
db_c⁄√˘i⁄_«me_
, 
DB_CONNECTION_NAME_LENGTH
);

38 
	`°∫˝y
(
u£r
, 
g_c⁄fig
.
logö_öfo_
.
db_u£r_
, 
DB_USER_NAME_LENGTH
);

39 
	`°∫˝y
(
∑ssw‹d
, 
g_c⁄fig
.
logö_öfo_
.
db_∑ssw‹d_
, 
DB_PASSWORD_LENGTH
);

40 #ñi‡
	`deföed
(
_PAP_SHARE_MEMORY
)

41 
	`°∫˝y
(
ho°
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_ho°_
, 
HOST_LENGTH
);

42 
p‹t
 = 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_p‹t_
;

43 
	`°∫˝y
(
c⁄√˘i⁄_«me
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_c⁄√˘i⁄_«me_
, 
DB_CONNECTION_NAME_LENGTH
);

44 
	`°∫˝y
(
u£r
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_u£r_
, 
DB_USER_NAME_LENGTH
);

45 
	`°∫˝y
(
∑ssw‹d
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_∑ssw‹d_
, 
DB_PASSWORD_LENGTH
);

47 
ho°
[
HOST_LENGTH
 - 1] = '\0';

48 
c⁄√˘i⁄_«me
[
DB_CONNECTION_NAME_LENGTH
 - 1] = '\0';

49 
u£r
[
DB_USER_NAME_LENGTH
 - 1] = '\0';

50 
∑ssw‹d
[
DB_PASSWORD_LENGTH
 - 1] = '\0';

52 
	`As£π
(
ch¨a˘î_öãrÁ˚_
);

53 
boﬁ
 
c⁄√˘ed
 = 
ch¨a˘î_öãrÁ˚_
->
	`c⁄√˘
(
c⁄√˘i⁄_«me
, 
u£r
, 
∑ssw‹d
);

54 i‡(!
c⁄√˘ed
) {

55 
Log
::
	`ßve_log
(
DB_LOG_FILE
,

57 
ch¨a˘î_öãrÁ˚_
->
	`gë_îr‹_mesßge
(),

58 
db_ty≥
);

60 i‡(
ALL_DATABASE
 =
db_ty≥
 || 
CHARACTER_DATABASE
 == db_type) {

62 
ch¨a˘î_öãrÁ˚_
 = 
√w
 
	`ODBCI¡îÁ˚
();

63 
	`mem£t
(
ho°
, 0, 
HOST_LENGTH
);

64 
p‹t
 = 3306;

65 
	`mem£t
(
c⁄√˘i⁄_«me
, 0, 
DB_CONNECTION_NAME_LENGTH
);

66 
	`mem£t
(
u£r
, 0, 
DB_USER_NAME_LENGTH
);

67 
	`mem£t
(
∑ssw‹d
, 0, 
DB_PASSWORD_LENGTH
);

68 #i‡
	`deföed
(
_PAP_LOGIN
)

69 
	`°∫˝y
(
ho°
, 
g_c⁄fig
.
logö_öfo_
.
db_ho°_
, 
HOST_LENGTH
);

70 
p‹t
 = 
g_c⁄fig
.
logö_öfo_
.
db_p‹t_
;

71 
	`°∫˝y
(
c⁄√˘i⁄_«me
, 
g_c⁄fig
.
logö_öfo_
.
db_c⁄√˘i⁄_«me_
, 
DB_CONNECTION_NAME_LENGTH
);

72 
	`°∫˝y
(
u£r
, 
g_c⁄fig
.
logö_öfo_
.
db_u£r_
, 
DB_USER_NAME_LENGTH
);

73 
	`°∫˝y
(
∑ssw‹d
, 
g_c⁄fig
.
logö_öfo_
.
db_∑ssw‹d_
, 
DB_PASSWORD_LENGTH
);

74 #ñi‡
	`deföed
(
_PAP_SHARE_MEMORY
)

75 
	`°∫˝y
(
ho°
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_ho°_
, 
HOST_LENGTH
);

76 
p‹t
 = 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_p‹t_
;

77 
	`°∫˝y
(
c⁄√˘i⁄_«me
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_c⁄√˘i⁄_«me_
, 
DB_CONNECTION_NAME_LENGTH
);

78 
	`°∫˝y
(
u£r
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_u£r_
, 
DB_USER_NAME_LENGTH
);

79 
	`°∫˝y
(
∑ssw‹d
, 
g_c⁄fig
.
sh¨e_mem‹y_öfo_
.
db_∑ssw‹d_
, 
DB_PASSWORD_LENGTH
);

81 
ho°
[
HOST_LENGTH
 - 1] = '\0';

82 
c⁄√˘i⁄_«me
[
DB_CONNECTION_NAME_LENGTH
 - 1] = '\0';

83 
u£r
[
DB_USER_NAME_LENGTH
 - 1] = '\0';

84 
∑ssw‹d
[
DB_PASSWORD_LENGTH
 - 1] = '\0';

86 
	`As£π
(
ch¨a˘î_öãrÁ˚_
);

87 
boﬁ
 
c⁄√˘ed
 = 
ch¨a˘î_öãrÁ˚_
->
	`c⁄√˘
(
c⁄√˘i⁄_«me
, 
u£r
, 
∑ssw‹d
);

88 i‡(!
c⁄√˘ed
) {

89 
Log
::
	`ßve_log
(
DB_LOG_FILE
,

91 
ch¨a˘î_öãrÁ˚_
->
	`gë_îr‹_mesßge
(),

92 
db_ty≥
);

96 i‡(
ALL_DATABASE
 =
db_ty≥
 || 
CHARACTER_DATABASE
 == db_type) {

98 
u£r_öãrÁ˚_
 = 
√w
 
	`ODBCI¡îÁ˚
();

99 
	`mem£t
(
ho°
, 0, 
HOST_LENGTH
);

100 
p‹t
 = 3306;

101 
	`mem£t
(
c⁄√˘i⁄_«me
, 0, 
DB_CONNECTION_NAME_LENGTH
);

102 
	`mem£t
(
u£r
, 0, 
DB_USER_NAME_LENGTH
);

103 
	`mem£t
(
∑ssw‹d
, 0, 
DB_PASSWORD_LENGTH
);

104 
	`°∫˝y
(
ho°
, 
g_c⁄fig
.
logö_öfo_
.
db_ho°_
, 
HOST_LENGTH
);

105 
p‹t
 = 
g_c⁄fig
.
logö_öfo_
.
db_p‹t_
;

106 
	`°∫˝y
(
c⁄√˘i⁄_«me
, 
g_c⁄fig
.
bûlög_öfo_
.
db_c⁄√˘i⁄_«me_
, 
DB_CONNECTION_NAME_LENGTH
);

107 
	`°∫˝y
(
u£r
, 
g_c⁄fig
.
bûlög_öfo_
.
db_u£r_
, 
DB_USER_NAME_LENGTH
);

108 
	`°∫˝y
(
∑ssw‹d
, 
g_c⁄fig
.
bûlög_öfo_
.
db_∑ssw‹d_
, 
DB_PASSWORD_LENGTH
);

109 
ho°
[
HOST_LENGTH
 - 1] = '\0';

110 
c⁄√˘i⁄_«me
[
DB_CONNECTION_NAME_LENGTH
 - 1] = '\0';

111 
u£r
[
DB_USER_NAME_LENGTH
 - 1] = '\0';

112 
∑ssw‹d
[
DB_PASSWORD_LENGTH
 - 1] = '\0';

114 
	`As£π
(
u£r_öãrÁ˚_
);

115 
boﬁ
 
c⁄√˘ed
 = 
u£r_öãrÁ˚_
->
	`c⁄√˘
(
c⁄√˘i⁄_«me
, 
u£r
, 
∑ssw‹d
);

116 i‡(!
c⁄√˘ed
) {

117 
Log
::
	`ßve_log
(
DB_LOG_FILE
,

119 
u£r_öãrÁ˚_
->
	`gë_îr‹_mesßge
(),

120 
db_ty≥
);

123 
__LEAVE_FUNCTION


126 
ODBCI¡îÁ˚
* 
DBM™agî
::
	`gë_öãrÁ˚
(
DB_TYPES
 
db_ty≥
) {

127 
__ENTER_FUNCTION


128 
ODBCI¡îÁ˚
* 
odbc_öãrÁ˚
;

129 
db_ty≥
) {

130 
CHARACTER_DATABASE
: {

131 
odbc_öãrÁ˚
 = 
ch¨a˘î_öãrÁ˚_
;

134 
USER_DATABASE
: {

135 
odbc_öãrÁ˚
 = 
u£r_öãrÁ˚_
;

139 
odbc_öãrÁ˚
 = 
NULL
;

142  
odbc_öãrÁ˚
;

143 
__LEAVE_FUNCTION


	@common/db/db_system.cc

1 
	~"£rvî/comm⁄/db/db_sy°em.h
"

2 
	~"comm⁄/pgame_utû.h
"

3 
	gDBSy°em
::
	$DBSy°em
()

5 
__ENTER_FUNCTION


6 
ªsu…_
 = 0;

7 
ªsu…_cou¡_
 = 0;

8 
›_ty≥_
 = 
OP_INIT_EMPTY
;

9 
__LEAVE_FUNCTION


10 
	}
}

12 
uöt
 
	gDBSy°em
::
	$gë_ªsu…_cou¡
() {

13 
__ENTER_FUNCTION


14  
ªsu…_cou¡_
;

15 
__LEAVE_FUNCTION


16 
	}
}

18 
DB_QUERY
* 
	gDBSy°em
::
	$gë_öã∫Æ_quîy
() {

19 
__ENTER_FUNCTION


20  &
odbc_öãrÁ˚_
->
	`gë_quîy
();

21 
__LEAVE_FUNCTION


22 
	}
}

24 
LONG_DB_QUERY
* 
	gDBSy°em
::
	$gë_l⁄g_öã∫Æ_quîy
() {

25 
__ENTER_FUNCTION


26  &
odbc_öãrÁ˚_
->
	`gë_l⁄g_quîy
();

27 
__LEAVE_FUNCTION


28 
	}
}

30 
	gDBSy°em
::
	$gë_öã∫Æ_af„˘_cou¡
() {

31 
__ENTER_FUNCTION


32  
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

33 
__LEAVE_FUNCTION


34 
	}
}

36 
boﬁ
 
	gDBSy°em
::
	$is_¥ï¨e
() {

37 
__ENTER_FUNCTION


38  
odbc_öãrÁ˚_
->
	`is_¥ï¨e
();

39 
__LEAVE_FUNCTION


40 
	}
}

42 
boﬁ
 
	gDBSy°em
::
	$check_db_c⁄√˘
() {

43 
__ENTER_FUNCTION


44 
	`As£π
(
odbc_öãrÁ˚_
);

45 i‡(!
odbc_öãrÁ˚_
->
	`is_c⁄√˘ed
()) {

46 
i
;

47 
i
 = 0; i <5; ++i) {

48 
PGameUtû
::
	`¶ìp
(5000);

49 i‡(
odbc_öãrÁ˚_
->
	`c⁄√˘
())

51  
åue
;

54  
Ál£
;

56 
__LEAVE_FUNCTION


57  
Ál£
;

58 
	}
}

60 
boﬁ
 
	gDBSy°em
::
	$lﬂd
() {

61 
__ENTER_FUNCTION


62 i‡(!
	`is_¥ï¨e
()Ë 
Ál£
;

63 i‡(!
odbc_öãrÁ˚_
Ë 
Ál£
;

64 
›_ty≥_
 = 
DB_LOAD
;

65 
ªsu…_
 = 
odbc_öãrÁ˚_
->
	`excuã
();

66 
ªsu…_cou¡_
 = 
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

67  
ªsu…_
;

68 
__LEAVE_FUNCTION


69  
Ál£
;

70 
	}
}

72 
boﬁ
 
	gDBSy°em
::
	$l⁄g_lﬂd
() {

73 
__ENTER_FUNCTION


74 i‡(!
	`is_¥ï¨e
()Ë 
Ál£
;

75 i‡(!
odbc_öãrÁ˚_
Ë 
Ál£
;

76 
›_ty≥_
 = 
DB_LOAD
;

77 
ªsu…_
 = 
odbc_öãrÁ˚_
->
	`l⁄g_excuã
();

78 
ªsu…_cou¡_
 = 
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

79  
ªsu…_
;

80 
__LEAVE_FUNCTION


81  
Ál£
;

82 
	}
}

84 
boﬁ
 
	gDBSy°em
::
	$add_√w
() {

85 
__ENTER_FUNCTION


86 i‡(!
	`is_¥ï¨e
()Ë 
Ál£
;

87 i‡(!
odbc_öãrÁ˚_
Ë 
Ál£
;

88 
›_ty≥_
 = 
DB_ADDNEW
;

89 
ªsu…_
 = 
odbc_öãrÁ˚_
->
	`excuã
();

90 
ªsu…_cou¡_
 = 
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

91  
ªsu…_
;

92 
__LEAVE_FUNCTION


93  
Ál£
;

94 
	}
}

96 
boﬁ
 
	gDBSy°em
::
	$dñëe_
() {

97 
__ENTER_FUNCTION


98 i‡(!
	`is_¥ï¨e
()Ë 
Ál£
;

99 i‡(!
odbc_öãrÁ˚_
Ë 
Ál£
;

100 
›_ty≥_
 = 
DB_DELETE
;

101 
ªsu…_
 = 
odbc_öãrÁ˚_
->
	`excuã
();

102 
ªsu…_cou¡_
 = 
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

103  
ªsu…_
;

104 
__LEAVE_FUNCTION


105  
Ál£
;

106 
	}
}

108 
boﬁ
 
	gDBSy°em
::
	$ßve
() {

109 
__ENTER_FUNCTION


110 i‡(!
	`is_¥ï¨e
()Ë 
Ál£
;

111 i‡(!
odbc_öãrÁ˚_
Ë 
Ál£
;

112 
›_ty≥_
 = 
DB_SAVE
;

113 
ªsu…_
 = 
odbc_öãrÁ˚_
->
	`excuã
();

114 
ªsu…_cou¡_
 = 
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

115  
ªsu…_
;

116 
__LEAVE_FUNCTION


117  
Ál£
;

118 
	}
}

120 
boﬁ
 
	gDBSy°em
::
	$l⁄g_ßve
() {

121 
__ENTER_FUNCTION


122 i‡(!
	`is_¥ï¨e
()Ë 
Ál£
;

123 i‡(!
odbc_öãrÁ˚_
Ë 
Ál£
;

124 
›_ty≥_
 = 
DB_SAVE
;

125 
ªsu…_
 = 
odbc_öãrÁ˚_
->
	`l⁄g_excuã
();

126 
ªsu…_cou¡_
 = 
odbc_öãrÁ˚_
->
	`gë_af„˘_row_cou¡
();

127  
ªsu…_
;

128 
__LEAVE_FUNCTION


129  
Ál£
;

130 
	}
}

132 
	gDBSy°em
::
	$£t_db_ty≥
(
DB_TYPES
 
db_ty≥
)

134 
__ENTER_FUNCTION


135 
db_ty≥_
 = 
db_ty≥


136 
__LEAVE_FUNCTION


137 
	}
}

139 
DBSy°em
::
	$gë_îr‹_code
() {

140 
__ENTER_FUNCTION


141  
odbc_öãrÁ˚_
->
	`gë_îr‹_code
();

142 
__LEAVE_FUNCTION


143 
	}
}

145 * 
	gDBSy°em
::
	$gë_îr‹_mesßge
() {

146 
__ENTER_FUNCTION


147  
odbc_öãrÁ˚_
->
	`gë_îr‹_mesßge
();

148 
__LEAVE_FUNCTION


149 
	}
}

	@common/db/odbc_interface.cc

1 
	~"£rvî/comm⁄/db/odbc_öãrÁ˚.h
"

2 
	~"comm⁄/pgame_utû.h
"

3 
	gODBCI¡îÁ˚
::
	$ODBCI¡îÁ˚
() {

4 
__ENTER_FUNCTION


5 
c⁄√˘d_
 = 
Ál£
;

6 
af„˘_cou¡_
 = -1;

7 
ªsu…_
 = 
SQL_SUCCESS
;

8 
sql_hív_
 = 
NULL
;

9 
sql_hdbc_
 = 
NULL
;

10 
sql_h°mt_
 = 
NULL
;

11 
	`mem£t
(
îr‹_mesßge_
, 0, 
MAX_ERROR_MESSAGE_LENGTH
);

12 
	`mem£t
(
c⁄√˘i⁄_«me_
, 0, 
DB_CONNECTION_NAME_LENGTH
);

13 
	`mem£t
(
u£r_
, 0, 
DB_USER_NAME_LENGTH
);

14 
	`mem£t
(
∑ssw‹d_
, 0, 
DB_PASSWORD_LENGTH
);

15 
quîy_
.
	`˛ór
();

16 
l⁄g_quî_
.
	`˛ór
();

17 
__LEAVE_FUNCTION


18 
	}
}

20 
	gODBCI¡îÁ˚
::~
	$ODBCI¡îÁ˚
() {

21 
__ENTER_FUNCTION


22 i‡(
sql_h°mt_
Ë
	`SQLFªeH™dÀ
(
SQL_HANDLE_STMT
, sql_hstmt_);

23 i‡(
sql_hdbc_
Ë
	`SQLDisc⁄√˘
(sql_hdbc_);

24 i‡(
sql_hdbc_
Ë
	`SQLFªeH™dÀ
(
SQL_HANDLE_DBC
, sql_hdbc_);

25 i‡(
sql_hív_
Ë
	`SQLFªeH™dÀ
(
SQL_HANDLE_ENV
, sql_henv_);

26 
__LEAVE_FUNCTION


27 
	}
}

29 
boﬁ
 
	gODBCI¡îÁ˚
::
	$c⁄√˘
(c⁄° * 
c⁄√˘i⁄_«me
,

30 c⁄° * 
u£r
,

31 c⁄° * 
∑ssw‹d
) {

32 
__ENTER_FUNCTION


33 
	`˛o£
();

34 
	`°∫˝y
(
c⁄√˘i⁄_«me_
, 
c⁄√˘i⁄_«me
, 
DB_CONNECTION_NAME_LENGTH
);

35 
	`°∫˝y
(
u£r_
, 
u£r
, 
DB_USER_NAME_LENGTH
);

36 
	`°∫˝y
(
∑ssw‹d_
, 
∑ssw‹d
, 
DB_PASSWORD_LENGTH
);

37 
	`SQLAŒocH™dÀ
(
SQL_HANDLE_ENV
, 
SQL_NULL_HANDLE
, &
sql_hív_
);

38 
	`SQLSëEnvAâr
(
sql_hív_
, 
SQL_ATTR_ODBC_VERSION
, 
°©ic_ˇ°
<
SQLPOINTER
>(
SQL_OV_ODBC3
), 
SQL_IS_INTEGER
);

39 
	`SQLAŒocH™dÀ
(
SQL_HANDLE_DBC
, 
sql_hív_
, &
sql_hdbc_
);

40 
ªsu…_
 = 
	`SQLC⁄√˘
(
hDbc
,

41 
°©ic_ˇ°
<
SQLCHAR
*>(
c⁄√˘i⁄_«me_
),

42 
SQL_NTS
,

43 
°©ic_ˇ°
<
SQLCHAR
*>(
u£r_
),

44 
SQL_NTS
,

45 
°©ic_ˇ°
<
SQLCHAR
*>(
∑ssw‹d_
),

46 
SQL_NTS
);

47 i‡(
SQL_SUCCESS
 !
ªsu…_
 && 
SQL_SUCCESS_WITH_INFO
 !=Ñesult_) {

48 
log_buf„r
[512] = {0};

49 
	`•rötf
(
log_buf„r
, "c⁄√˘i⁄Çame: %s", 
c⁄√˘i⁄_«me_
);

50 
	`•rötf
(
log_buf„r
, "c⁄√˘ u£r: %s", 
u£r_
);

51 
	`düg_°©e
();

52  
Ál£
;

54 
ªsu…_
 = 
	`SQLAŒocH™dÀ
(
SQL_HANDLE_STMT
, 
sql_hdbc_
, &
sql_h°mt_
);

55 i‡(
SQL_SUCCESS
 !
ªsu…_
 && 
SQL_SUCCESS_WITH_INFO
 !=Ñesult_) {

56 
sql_h°mt_
 = 
NULL
;

57  
Ál£
;

59 
c⁄√˘d_
 = 
åue
;

60  
åue
;

61 
__LEAVE_FUNCTION


62  
Ál£
;

63 
	}
}

65 
boﬁ
 
	gODBCI¡îÁ˚
::
	$c⁄√˘
() {

66 
__ENTER_FUNCTION


67 
	`˛o£
();

68 #ifde‡
MUST_CLOSE_HENV_HANDLE


69 
	`SQLAŒocH™dÀ
(
SQL_HANDLE_ENV
, 
SQL_NULL_HANDLE
, &
sql_hív_
);

70 
	`SQLSëEnvAâr
(
sql_hív_
, 
SQL_ATTR_ODBC_VERSION
, 
°©ic_ˇ°
<
SQLPOINTER
>(
SQL_OV_ODBC3
), 
SQL_IS_INTEGER
);

72 
	`SQLAŒocH™dÀ
(
SQL_HANDLE_DBC
, 
sql_hív_
, &
sql_hdbc_
);

73 
ªsu…_
 = 
	`SQLC⁄√˘
(
hDbc
,

74 
°©ic_ˇ°
<
SQLCHAR
*>(
d©aba£_
),

75 
SQL_NTS
,

76 
°©ic_ˇ°
<
SQLCHAR
*>(
u£r_
),

77 
SQL_NTS
,

78 
°©ic_ˇ°
<
SQLCHAR
*>(
∑ssw‹d_
),

79 
SQL_NTS
);

80 i‡(
SQL_SUCCESS
 !
ªsu…_
 && 
SQL_SUCCESS_WITH_INFO
 !=Ñesult_) {

81 
log_buf„r
[512] = {0};

82 
	`•rötf
(
log_buf„r
, "c⁄√˘ d©aba£: %s", 
d©aba£_
);

83 
	`•rötf
(
log_buf„r
, "c⁄√˘ u£r: %s", 
u£r_
);

84 
	`düg_°©e
();

85  
Ál£
;

87 
ªsu…_
 = 
	`SQLAŒocH™dÀ
(
SQL_HANDLE_STMT
, 
sql_hdbc_
, &
sql_h°mt_
);

88 i‡(
SQL_SUCCESS
 !
ªsu…_
 && 
SQL_SUCCESS_WITH_INFO
 !=Ñesult_) {

89 
sql_h°mt_
 = 
NULL
;

90  
Ál£
;

92 
c⁄√˘d_
 = 
åue
;

93  
åue
;

94 
__LEAVE_FUNCTION


95  
Ál£
;

96 
	}
}

98 
boﬁ
 
	gODBCI¡îÁ˚
::
	$˛o£
() {

99 
__ENTER_FUNCTION


100 i‡(
sql_h°mt_
) {

101 
åy
 {

102 
	`SQLClo£Curs‹
(
sql_h°mt_
);

103 
	`SQLFªeStmt
(
sql_h°mt_
, 
SQL_UNBIND
);

104 
	`SQLFªeH™dÀ
(
SQL_HANDLE_STMT
, 
sql_h°mt_
);

105 
sql_h°mt_
 = 
NULL
;

107 
	`ˇtch
(...) {

108 
sql_h°mt_
 = 
NULL
;

112 i‡(
sql_hdbc_
) {

113 
åy
 {

114 
	`SQLDisc⁄√˘
(
sql_hdbc_
);

115 
	`SQLFªeH™dÀ
(
SQL_HANDLE_DBC
, 
sql_hdbc_
);

116 
sql_hdbc_
 = 
NULL
;

118 
	`ˇtch
(...) {

119 
sql_hdbc_
 = 
NULL
;

123 #ifde‡
MUST_CLOSE_HENV_HANDLE


124 i‡(
sql_hív_
) {

125 
åy
 {

126 
	`SQLFªeH™dÀ
(
SQL_HANDLE_ENV
, 
sql_hív_
);

127 
sql_hív_
 = 
NULL
;

129 
	`ˇtch
(...) {

130 
sql_hív_
 = 
NULL
;

134 
c⁄√˘d_
 = 
Ál£
;

135  
åue
;

136 
__LEAVE_FUNCTION


137  
Ál£
;

138 
	}
}

140 
boﬁ
 
	gODBCI¡îÁ˚
::
	$excuã
() {

141 
__ENTER_FUNCTION


143 
ªsu…_
 = 
	`SQLExecDúe˘
(
sql_h°mt_
, 
°©ic_ˇ°
<
SQLCHAR
*>(
quîy_
.
sql_°r_
), 
SQL_NTS
);

144 i‡((
SQL_SUCCESS
 !
ªsu…_
) &&

145 (
SQL_SUCCESS_WITH_INFO
 !
ªsu…_
) &&

146 (
SQL_NO_DATA
 !
ªsu…_
)) {

147 
	`düg_°©e
();

148  
Ál£
;

150 
	`SQLRowCou¡
(
sql_h°mt_
, &
af„˘_cou¡_
);

151 
	`SQLNumResu…Cﬁs
(
sql_h°mt_
, &
cﬁumn_cou¡_
);

152 i‡(
MAX_COLUMN
 < 
cﬁumn_cou¡_
Ë 
Ál£
;

153 i‡(0 >
af„˘_cou¡_
 && 0 >
cﬁumn_cou¡_
) {

154 
	`˛ór
();

155  
åue
;

177  
åue
;

178 
__LEAVE_FUNCTION


179 
	`ßve_îr‹_log
("Huge Error occur:");

180 
	`ßve_îr‹_log
(
°©ic_ˇ°
<c⁄° *>(
quîy_
.
sql_°r_
));

181  
Ál£
;

182 
	}
}

184 
boﬁ
 
	gODBCI¡îÁ˚
::
	$excuã
(c⁄° * 
sql_°r
) {

185 
__ENTER_FUNCTION


186 
	`mem£t
(
quîy_
.
sql_°r_
, 0, 
MAX_SQL_LENGTH
);

187 
	`°∫˝y
(
quîy_
.
sql_°r_
, sql_°r_, 
MAX_SQL_LENGTH
);

188  
	`execuã
();

189 
__LEAVE_FUNCTION


190  
Ál£
;

191 
	}
}

193 
boﬁ
 
	gODBCI¡îÁ˚
::
	$l⁄g_excuã
() {

194 
__ENTER_FUNCTION


196 
ªsu…_
 = 
	`SQLExecDúe˘
(
sql_h°mt_
, 
°©ic_ˇ°
<
SQLCHAR
*>(
l⁄g_quîy_
.
sql_°r_
), 
SQL_NTS
);

197 i‡((
SQL_SUCCESS
 !
ªsu…_
) &&

198 (
SQL_SUCCESS_WITH_INFO
 !
ªsu…_
) &&

199 (
SQL_NO_DATA
 !
ªsu…_
)) {

200 
	`düg_°©e_ex
();

201  
Ál£
;

203 
	`SQLRowCou¡
(
sql_h°mt_
, &
af„˘_cou¡_
);

204 
	`SQLNumResu…Cﬁs
(
sql_h°mt_
, &
cﬁumn_cou¡_
);

205 i‡(
MAX_COLUMN
 < 
cﬁumn_cou¡_
Ë 
Ál£
;

206 i‡(0 >
af„˘_cou¡_
 && 0 >
cﬁumn_cou¡_
) {

207 
	`˛ór
();

208  
åue
;

229  
åue
;

230 
__LEAVE_FUNCTION


231 
	`ßve_îr‹_log
("Huge Error occur:");

232 
	`ßve_îr‹_log
(
°©ic_ˇ°
<c⁄° *>(
quîy_
.
sql_°r_
));

233  
Ál£
;

234 
	}
}

236 
boﬁ
 
	gODBCI¡îÁ˚
::
	$l⁄g_excuã
(c⁄° * 
sql_°r
) {

237 
__ENTER_FUNCTION


238 
	`mem£t
(
l⁄g_quîy_
.
sql_°r_
, 0, 
MAX_LONG_SQL_LENGTH
);

239 
	`°∫˝y
(
l⁄g_quîy_
.
sql_°r_
, sql_°r_, 
MAX_LONG_SQL_LENGTH
);

240  
	`l⁄g_execuã
();

241 
__LEAVE_FUNCTION


242  
Ál£
;

243 
	}
}

245 
	gODBCI¡îÁ˚
::
	$˛ór_no_commô
() {

246 
__ENTER_FUNCTION


247 
	`SQLClo£Curs‹
(
sql_h°mt_
);

248 
	`SQLFªeStmt
(
sql_h°mt_
, 
SQL_UNBIND
);

249 
__LEAVE_FUNCTION


250 
	}
}

252 
	gODBCI¡îÁ˚
::
	$˛ór
() {

253 
__ENTER_FUNCTION


254 
	`SQLClo£Curs‹
(
sql_h°mt_
);

255 
	`SQLFªeStmt
(
sql_h°mt_
, 
SQL_UNBIND
);

256 
__LEAVE_FUNCTION


257 
	}
}

259 
boﬁ
 
	gODBCI¡îÁ˚
::
	$„tch
() {

260 
__ENTER_FUNCTION


261 
ªsu…_
 = 
	`SQLFëch
(
sql_h°mt_
);

262 i‡((
SQL_SUCCESS
 !
ªsu…_
) &&

263 (
SQL_SUCCESS_WITH_INFO
 !
ªsu…_
)) {

264 
	`düg_°©e
();

265  
Ál£
;

267 
cﬁumn_ödex
 = 0; cﬁumn_ödex < 
cﬁumn_cou¡_
; ++column_index) {

268 
gë_tŸÆ
 = 0;

269 
SQLLEN
 
d©a_Àngth
 = 0;

270 (
ªsu…_
 = 
	`SQLGëD©a
(
sql_h°mt_
,

271 
cﬁumn_ödex
 + 1,

272 
SQL_C_CHAR
,

273 
cﬁumn_
[
cﬁumn_ödex
] + 
gë_tŸÆ
,

274 
MAX_COLUMN_BUFFER
,

275 &
d©a_Àngth
)Ë!
SQL_NO_DATA
) {

279  
åue
;

280 
__LEAVE_FUNCTION


281  
Ál£
;

282 
	}
}

284 
boﬁ
 
	gODBCI¡îÁ˚
::
	$l⁄g_„tch
() {

285 
__ENTER_FUNCTION


286 
ªsu…_
 = 
	`SQLFëch
(
sql_h°mt_
);

287 i‡((
SQL_SUCCESS
 !
ªsu…_
) &&

288 (
SQL_SUCCESS_WITH_INFO
 !
ªsu…_
)) {

289 
	`düg_°©e
();

290  
Ál£
;

292 
cﬁumn_ödex
 = 0; cﬁumn_ödex < 
cﬁumn_cou¡_
; ++column_index) {

293 
gë_tŸÆ
 = 0;

294 
SQLLEN
 
d©a_Àngth
 = 0;

295 (
ªsu…_
 = 
	`SQLGëD©a
(
sql_h°mt_
,

296 
cﬁumn_ödex
 + 1,

297 
SQL_C_CHAR
,

298 
cﬁumn_
[
cﬁumn_ödex
] + 
gë_tŸÆ
,

299 
MAX_LONG_COLUMN_BUFFER
,

300 &
d©a_Àngth
)Ë!
SQL_NO_DATA
) {

304  
åue
;

305 
__LEAVE_FUNCTION


306  
Ál£
;

307 
	}
}

309 
	gODBCI¡îÁ˚
::
	$gë_öt
(
cﬁumn_ödex
, &
îr‹_code
) {

310 
__ENTER_FUNCTION


311 i‡(
cﬁumn_ödex
 > 
cﬁumn_cou¡_
) {

312 
îr‹_code
 = 
QUERY_NO_COLUMN
;

313 
	`As£π
(
Ál£
);

314  
QUERY_NO_COLUMN
;

316 i‡(
SQL_NULL_DATA
 =
cﬁumn_loˇã_
[
cﬁumn_ödex
 - 1]) {

317 
îr‹_code
 = 
QUERY_NULL
;

318 
	`As£π
(
Ál£
);

319  
QUERY_NULL
;

322 
îr‹_code
 = 
QUERY_OK
;

323  
	`©oi
(
cﬁumn_
[
cﬁumn_ödex
 - 1]);

325 
__LEAVE_FUNCTION


326  
QUERY_NULL
;

327 
	}
}

329 
uöt32_t
 
	gODBCI¡îÁ˚
::
	$gë_uöt
(
cﬁumn_ödex
, &
îr‹_code
) {

330 
__ENTER_FUNCTION


331 i‡(
cﬁumn_ödex
 > 
cﬁumn_cou¡_
) {

332 
îr‹_code
 = 
QUERY_NO_COLUMN
;

333 
	`As£π
(
Ál£
);

334  
QUERY_NO_COLUMN
;

336 i‡(
SQL_NULL_DATA
 =
cﬁumn_loˇã_
[
cﬁumn_ödex
 - 1]) {

337 
îr‹_code
 = 
QUERY_NULL
;

338 
	`As£π
(
Ál£
);

339  
QUERY_NULL
;

342 
îr‹_code
 = 
QUERY_OK
;

343  
°©ic_ˇ°
<
uöt32_t
>(
	`©oi
(
cﬁumn_
[
cﬁumn_ödex
 - 1]));

345 
__LEAVE_FUNCTION


346  
QUERY_NULL
;

347 
	}
}

349 
	gODBCI¡îÁ˚
::
	$gë_Êﬂt
(
cﬁumn_ödex
, &
îr‹_code
) {

350 
__ENTER_FUNCTION


351 i‡(
cﬁumn_ödex
 > 
cﬁumn_cou¡_
) {

352 
îr‹_code
 = 
QUERY_NO_COLUMN
;

353 
	`As£π
(
Ál£
);

354  
QUERY_NO_COLUMN
;

356 i‡(
SQL_NULL_DATA
 =
cﬁumn_loˇã_
[
cﬁumn_ödex
 - 1]) {

357 
îr‹_code
 = 
QUERY_NULL
;

358 
	`As£π
(
Ál£
);

359  
QUERY_NULL
;

362 
îr‹_code
 = 
QUERY_OK
;

363  
	`©of
(
cﬁumn_
[
cﬁumn_ödex
 - 1]);

365 
__LEAVE_FUNCTION


366  
QUERY_NULL
;

367 
	}
}

369 
	gODBCI¡îÁ˚
::
	$gë_°rög
(
cﬁumn_ödex
,

370 * 
buf„r
,

371 
buf„r_Àngth
,

372 &
îr‹_code
) {

373 
__ENTER_FUNCTION


374 i‡(
cﬁumn_ödex
 > 
cﬁumn_cou¡_
) {

375 
îr‹_code
 = 
QUERY_NO_COLUMN
;

376 
buf„r
[0] = '\0';

377 
	`As£π
(
Ál£
);

380 i‡(
SQL_NULL_DATA
 =
cﬁumn_loˇã_
[
cﬁumn_ödex
 - 1]) {

381 
îr‹_code
 = 
QUERY_NULL
;

382 
buf„r
[0] = '\0';

383 
	`As£π
(
Ál£
);

386 i‡(
MAX_COLUMN_BUFFER
 > 
buf„r_Àngth
) {

387 
	`°∫˝y
(
buf„r
, 
cﬁumn_
[
cﬁumn_ödex
 - 1], 
buf„r_Àngth
);

390 
	`°∫˝y
(
buf„r
, 
cﬁumn_
[
cﬁumn_ödex
 - 1], 
MAX_COLUMN_BUFFER
);

392 
îr‹_code
 = 
QUERY_OK
;

394 
__LEAVE_FUNCTION


395 
	}
}

397 
	gODBCI¡îÁ˚
::
	$gë_fõld
(
cﬁumn_ödex
,

398 * 
buf„r
,

399 
buf„r_Àngth
,

400 & 
îr‹_code
) {

401 
__ENTER_FUNCTION


402 i‡(
cﬁumn_ödex
 > 
cﬁumn_cou¡_
) {

403 
îr‹_code
 = 
QUERY_NO_COLUMN
;

404 
buf„r
[0] = '\0';

405 
	`As£π
(
Ál£
);

408 i‡(
SQL_NULL_DATA
 =
cﬁumn_loˇã_
[
cﬁumn_ödex
 - 1]) {

409 
îr‹_code
 = 
QUERY_NULL
;

410 
buf„r
[0] = '\0';

411 
	`As£π
(
Ál£
);

414 i‡(
MAX_COLUMN_BUFFER
 > 
buf„r_Àngth
) {

415 
uöt32_t
 
out_Àngth
 = 0;

416 
PGameUtû
::
	`°rög_to_bö¨y
(
cﬁumn_
[
cﬁumn_ödex
 - 1],

417 
MAX_COLUMN_BUFFER
,

418 
buf„r
,

419 
buf„r_Àngth
,

420 
out_Àngth
);

421 
	`As£π
(
°©ic_ˇ°
<>(
out_Àngth
Ë<
buf„r_Àngth
);

424 
	`mem˝y
(
buf„r
, 
cﬁumn_
[
cﬁumn_ödex
 - 1], 
MAX_COLUMN_BUFFER
);

425 
	`As£π
(
Ál£
);

427 
îr‹_code
 = 
QUERY_OK
;

429 
__LEAVE_FUNCTION


430 
	}
}

432 
	gODBCI¡îÁ˚
::
	$gë_l⁄g_fõld
(
cﬁumn_ödex
,

433 * 
buf„r
,

434 
buf„r_Àngth
,

435 & 
îr‹_code
) {

436 
__ENTER_FUNCTION


437 i‡(
cﬁumn_ödex
 > 
cﬁumn_cou¡_
) {

438 
îr‹_code
 = 
QUERY_NO_COLUMN
;

439 
buf„r
[0] = '\0';

440 
	`As£π
(
Ál£
);

443 i‡(
SQL_NULL_DATA
 =
cﬁumn_loˇã_
[
cﬁumn_ödex
 - 1]) {

444 
îr‹_code
 = 
QUERY_NULL
;

445 
buf„r
[0] = '\0';

446 
	`As£π
(
Ál£
);

449 i‡(
MAX_COLUMN_BUFFER
 > 
buf„r_Àngth
) {

450 
uöt32_t
 
out_Àngth
 = 0;

451 
PGameUtû
::
	`°rög_to_bö¨y
(
cﬁumn_
[
cﬁumn_ödex
 - 1],

452 
MAX_LONG_COLUMN_BUFFER
,

453 
buf„r
,

454 
buf„r_Àngth
,

455 
out_Àngth
);

456 
	`As£π
(
°©ic_ˇ°
<>(
out_Àngth
Ë<
buf„r_Àngth
);

459 
	`mem˝y
(
buf„r
, 
cﬁumn_
[
cﬁumn_ödex
 - 1], 
MAX_LONG_COLUMN_BUFFER
);

460 
	`As£π
(
Ál£
);

462 
îr‹_code
 = 
QUERY_OK
;

464 
__LEAVE_FUNCTION


465 
	}
}

467 
	gODBCI¡îÁ˚
::
	$düg_°©e
() {

468 
__ENTER_FUNCTION


469 
j
 = 1;

470 
SQLINTEGER
 
«tive_îr‹
;

471 
SQLCHAR
 
sql_°©e
[6];

472 
SQLSMALLINT
 
msg_Àngth
;

473 
	`mem£t
(
îr‹_mesßge_
, 0, 
MAX_ERROR_MESSAGE_LENGTH
);

474 (
ªsu…_
 = 
	`SQLGëDügRec
(
SQL_HANDLE_DBC
,

475 
sql_hdbc_
,

476 
j
,

477 
sql_°©e
,

478 &
«tive_îr‹
,

479 
îr‹_mesßge_
,

480 (
îr‹_mesßge_
),

481 &
msg_Àngth
)Ë!=
SQL_NO_DATA
) {

482 ++
j
;

484 
îr‹_mesßge_
[
MAX_ERROR_MSG_LENGHT
 - 1] = '\0';

485 i‡(0 =
	`°æí
(
°©ic_ˇ°
<c⁄° *>(
îr‹_mesßge_
))) {

486 
ªsu…_
 = 
	`SQLEº‹
(
sql_hív_
,

487 
sql_hdbc_
,

488 
sql_h°mt_
,

489 
sql_°©e
,

490 &
«tive_îr‹
,

491 
îr‹_mesßge_
,

492 (
îr‹_mesßge_
),

493 &
msg_Àngth
);

495 
îr‹_code_
 = 
«tive_îr‹
;

496 
îr‹_code_
) {

504 
	`˛o£
();

507 
îr‹_buf„r
[512] = {0};

508 
	`•rötf
(
îr‹_buf„r
,"îr‹ code: %d,Éº‹ msg: %s,îr‹ sql", 
îr‹_code_
, 
îr‹_mesßge_
);

509 
	`ßve_îr‹_log
(
îr‹_buf„r
);

510 
	`ßve_îr‹_log
(
°©ic_ˇ°
<c⁄° *>(
quîy_
.
sql_°r_
));

511 
__LEAVE_FUNCTION


512 
	}
}

514 
	gODBCI¡îÁ˚
::
	$düg_°©e_ex
() {

515 
__ENTER_FUNCTION


516 
j
 = 1;

517 
SQLINTEGER
 
«tive_îr‹
;

518 
SQLCHAR
 
sql_°©e
[6];

519 
SQLSMALLINT
 
msg_Àngth
;

520 
	`mem£t
(
îr‹_mesßge_
, 0, 
MAX_ERROR_MESSAGE_LENGTH
);

521 (
ªsu…_
 = 
	`SQLGëDügRec
(
SQL_HANDLE_DBC
,

522 
sql_hdbc_
,

523 
j
,

524 
sql_°©e
,

525 &
«tive_îr‹
,

526 
îr‹_mesßge_
,

527 (
îr‹_mesßge_
),

528 &
msg_Àngth
)Ë!=
SQL_NO_DATA
) {

529 ++
j
;

531 
îr‹_mesßge_
[
MAX_ERROR_MSG_LENGHT
 - 1] = '\0';

532 i‡(0 =
	`°æí
(
°©ic_ˇ°
<c⁄° *>(
îr‹_mesßge_
))) {

533 
ªsu…_
 = 
	`SQLEº‹
(
sql_hív_
,

534 
sql_hdbc_
,

535 
sql_h°mt_
,

536 
sql_°©e
,

537 &
«tive_îr‹
,

538 
îr‹_mesßge_
,

539 (
îr‹_mesßge_
),

540 &
msg_Àngth
);

542 
îr‹_code_
 = 
«tive_îr‹
;

543 
îr‹_code_
) {

551 
	`˛o£
();

554 
îr‹_buf„r
[512] = {0};

555 
	`•rötf
(
îr‹_buf„r
,"îr‹ code: %d,Éº‹ msg: %s,îr‹ sql", 
îr‹_code_
, 
îr‹_mesßge_
);

556 
	`ßve_îr‹_log
(
îr‹_buf„r
);

557 
	`ßve_îr‹_log
(
°©ic_ˇ°
<c⁄° *>(
l⁄g_quîy_
.
sql_°r_
));

558 
__LEAVE_FUNCTION


559 
	}
}

560 
	gODBCI¡îÁ˚
::
	$ßve_îr‹_log
(c⁄° * 
log
) {

561 
__ENTER_FUNCTION


562 i‡(0 =
	`°æí
(
log
)) ;

563 
FILE
* 
f
 = 
	`f›í
("./Log/dberror.log", "a");

564 i‡(
f
) {

565 
	`fwrôe
(
log
, 1, 
	`°æí
÷og), 
f
);

566 
	`fwrôe
(
LF
, 1, (LF), 
f
);

567 
	`f˛o£
(
f
);

569 
__LEAVE_FUNCTION


570 
	}
}

572 
	gODBCI¡îÁ˚
::
	$ßve_w¨nög_log
(c⁄° * 
log
) {

573 
__ENTER_FUNCTION


574 i‡(0 =
	`°æí
(
log
)) ;

575 
FILE
* 
f
 = 
	`f›í
("./Log/dbwarning.log", "a");

576 i‡(
f
) {

577 
	`fwrôe
(
log
, 1, 
	`°æí
÷og), 
f
);

578 
	`fwrôe
(
LF
, 1, (LF), 
f
);

579 
	`f˛o£
(
f
);

581 
__LEAVE_FUNCTION


582 
	}
}

584 
	gODBCI¡îÁ˚
::
	$˛ór_ív
() {

585 
__ENTER_FUNCTION


586 i‡(
sql_h°mt_
) {

587 
	`SQLClo£Curs‹
(
sql_h°mt_
);

588 
	`SQLFªeStmt
(
sql_h°mt_
, 
SQL_UNBIND
);

589 
	`SQLFªeH™dÀ
(
SQL_HANDLE_STMT
,
sql_h°mt_
);

590 
sql_h°mt_
 = 
NULL
;

592 i‡(
sql_hdbc_
) {

593 
	`SQLDisc⁄√˘
(
sql_hdbc_
);

594 
	`SQLFªeH™dÀ
(
SQL_HANDLE_DBC
, 
sql_hdbc_
);

595 
sql_hdbc_
 = 
NULL
;

597 #ifde‡
MUST_CLOSE_HENV_HANDLE


598 i‡(
sql_hív_
) {

599 
	`SQLFªeH™dÀ
(
SQL_HANDLE_ENV
, 
sql_hív_
);

600 
sql_hív_
 = 
NULL
;

603 
__LEAVE_FUNCTION


604 
	}
}

606 
	gODBCI¡îÁ˚
::
	$dump
(
cﬁumn_ödex
) {

607 
__ENTER_FUNCTION


608 
FILE
* 
f
 = 
	`f›í
("./Log/field", "a");

609 i‡(
f
) {

610 
	`fwrôe
("begö", 1, 5, 
f
);

611 
	`fwrôe
(
cﬁumn_
[
cﬁumn_ödex
 - 1], 1, 
MAX_COLUMN_BUFFER
, 
f
);

612 
	`f˛o£
(
f
);

614 
__LEAVE_FUNCTION


615 
	}
}

617 
ush‹t
 
	gODBCI¡îÁ˚
::
	$gë_ush‹t
(
cﬁumn_ödex
, &
îr‹_code
) {

618 
__ENTER_FUNCTION


619  
°©ic_ˇ°
<>(
	`gë_öt
(
cﬁumn_ödex
, 
îr‹_code
));

620 
__LEAVE_FUNCTION


621 
	}
}

623 
ubyã
 
	gODBCI¡îÁ˚
::
	$gë_byã
(
cﬁumn_ödex
, &
îr‹_code
) {

624 
__ENTER_FUNCTION


625  
°©ic_ˇ°
<>(
	`gë_öt
(
cﬁumn_ödex
, 
îr‹_code
));

626 
__LEAVE_FUNCTION


627 
	}
}

629 
	gODBCI¡îÁ˚
::
	$gë_sh‹t
(
cﬁumn_ödex
, &
îr‹_code
) {

630 
__ENTER_FUNCTION


631  
°©ic_ˇ°
<>(
	`gë_öt
(
cﬁumn_ödex
, 
îr‹_code
));

632 
__LEAVE_FUNCTION


633 
	}
}

635 
	gODBCI¡îÁ˚
::
	$gë_îr‹_code
() {

636 
__ENTER_FUNCTION


637  
îr‹_code_
;

638 
__LEAVE_FUNCTION


639 
	}
}

641 * 
	gODBCI¡îÁ˚
::
	$gë_îr‹_mesßge
() {

642 
__ENTER_FUNCTION


643  
îr‹_mesßge_
;

644 
__LEAVE_FUNCTION


645 
	}
}

647 
boﬁ
 
	gODBCI¡îÁ˚
::
	$is_c⁄√˘ed
() {

648 
__ENTER_FUNCTION


649  
c⁄√˘d_
;

650 
__LEAVE_FUNCTION


651 
	}
}

653 
	gODBCI¡îÁ˚
::
	$gë_af„˘_row_cou¡
() {

654 
__ENTER_FUNCTION


655  
af„˘_cou¡_
;

656 
__LEAVE_FUNCTION


657 
	}
}

659 
boﬁ
 
	gODBCI¡îÁ˚
::
	$is_¥ï¨e
() {

660 
__ENTER_FUNCTION


661  
c⁄√˘d_
;

662 
__LEAVE_FUNCTION


663 
	}
}

665 
	gDB_QUERY
& 
	gODBCI¡îÁ˚
::
	$gë_quîy
() {

666 
__ENTER_FUNCTION


667  
quîy_
;

668 
__LEAVE_FUNCTION


669 
	}
}

671 
	gLONG_DB_QUERY
& 
	gODBCI¡îÁ˚
::
	$gë_l⁄g_quîy
() {

672 
__ENTER_FUNCTION


673  
l⁄g_quîy_
;

674 
__LEAVE_FUNCTION


675 
	}
}

	@common/thread.cc

	@
1
.
0
17
483
../../include/common/base/type.h
../../include/common/base/util.h
../../include/common/game/all_defind.h
../../include/common/game/define.h
../../include/common/game/structs.h
../../include/common/md5.h
../../include/common/sys/assert.h
../../include/common/sys/info.h
../common/base/md5.cc
../common/base/util.cc
../common/sys/assert.cc
../common/sys/passert.cc
../common/sys/systeminfo.cc
common/db/db_manager.cc
common/db/db_system.cc
common/db/odbc_interface.cc
common/thread.cc
